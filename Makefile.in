.DEFAULT_GOAL := all

PRO = OpenBlox.pro
PRO_TEST = OpenBloxTest.pro

PACKAGE_TARNAME = libopenblox

QMAKE = @QMAKEVAR@

prefix = @prefix@
exec_prefix = @exec_prefix@

includedir = @includedir@
docdir = @docdir@
libdir = @libdir@
man3dir = @mandir@/man3

clean:
	rm -fr QtMakefile QtMakefile.Debug QtMakefile.Release debug release libopenblox.so libopenblox.so.*

QtMakefile:
	$(QMAKE) -o QtMakefile $(PRO) CONFIG+=debug_and_release

debug:	QtMakefile
	$(MAKE) -j 2 -f QtMakefile debug

release:	QtMakefile
	$(MAKE) -j 2 -f QtMakefile release

all:	QtMakefile
	$(MAKE) -j 2 -f QtMakefile

test:	$(QMAKE) -o QtMakefile $(PRO_TEST) CONFIG+=debug_and_release
	$(MAKE) -j 2 -f QtMakefile

install:
	mkdir -p $(DESTDIR)$(man3dir)
	cp -f libopenblox.3.gz $(DESTDIR)$(man3dir)
	mkdir -p $(DESTDIR)$(libdir)
	cp -f libopenblox.so $(DESTDIR)$(libdir)
	ln -s $(DESTDIR)$(libdir)/libopenblox.so $(DESTDIR)$(libdir)/libopenblox.so.1
	mkdir -p $(DESTDIR)$(includedir)/libopenblox/raknet
	cp -f raknet/*.h $(DESTDIR)$(includedir)/libopenblox/raknet
	mkdir -p $(DESTDIR)$(includedir)/libopenblox/ob_lua
	cp -f src/ob_lua/*.h $(DESTDIR)$(includedir)/libopenblox/ob_lua
	mkdir -p $(DESTDIR)$(includedir)/libopenblox/openblox
	cp -f src/openblox/*.h $(DESTDIR)$(includedir)/libopenblox/openblox
	mkdir -p $(DESTDIR)$(includedir)/libopenblox/openblox/enum
	cp -f src/openblox/enum/*.h $(DESTDIR)$(includedir)/libopenblox/openblox/enum
	mkdir -p $(DESTDIR)$(includedir)/libopenblox/openblox/instance
	cp -f src/openblox/instance/*.h $(DESTDIR)$(includedir)/libopenblox/openblox/instance
	mkdir -p $(DESTDIR)$(includedir)/libopenblox/openblox/type
	cp -f src/openblox/type/*.h $(DESTDIR)$(includedir)/libopenblox/openblox/type

docs: doxygen

.PHONY: all clean debug release QtMakefile install docs
